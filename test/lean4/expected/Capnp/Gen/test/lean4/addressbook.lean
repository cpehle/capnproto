-- Generated by capnpc-lean4; DO NOT EDIT.
-- source: test/lean4/addressbook.capnp

import Capnp.Runtime
import Capnp.Rpc

set_option maxHeartbeats 2000000


namespace Capnp.Gen.test.lean4.addressbook

structure Person.Reader where
  struct : Capnp.StructReader

  deriving BEq

def Person.read (ptr : Capnp.AnyPointer) : Person.Reader := { struct := Capnp.readStruct ptr }
def Person.readChecked (ptr : Capnp.AnyPointer) : Except String Person.Reader := do
  let sr ← Capnp.readStructChecked ptr
  return { struct := sr }
def Person.fromStruct (sr : Capnp.StructReader) : Person.Reader := { struct := sr }

structure Person.Builder where
  struct : Capnp.StructBuilder

  deriving BEq

def Person.Builder.fromStruct (sb : Capnp.StructBuilder) : Person.Builder := { struct := sb }


structure Person.PhoneNumber.Reader where
  struct : Capnp.StructReader

  deriving BEq

def Person.PhoneNumber.read (ptr : Capnp.AnyPointer) : Person.PhoneNumber.Reader := { struct := Capnp.readStruct ptr }
def Person.PhoneNumber.readChecked (ptr : Capnp.AnyPointer) : Except String Person.PhoneNumber.Reader := do
  let sr ← Capnp.readStructChecked ptr
  return { struct := sr }
def Person.PhoneNumber.fromStruct (sr : Capnp.StructReader) : Person.PhoneNumber.Reader := { struct := sr }

structure Person.PhoneNumber.Builder where
  struct : Capnp.StructBuilder

  deriving BEq

def Person.PhoneNumber.Builder.fromStruct (sb : Capnp.StructBuilder) : Person.PhoneNumber.Builder := { struct := sb }


structure AddressBook.Reader where
  struct : Capnp.StructReader

  deriving BEq

def AddressBook.read (ptr : Capnp.AnyPointer) : AddressBook.Reader := { struct := Capnp.readStruct ptr }
def AddressBook.readChecked (ptr : Capnp.AnyPointer) : Except String AddressBook.Reader := do
  let sr ← Capnp.readStructChecked ptr
  return { struct := sr }
def AddressBook.fromStruct (sr : Capnp.StructReader) : AddressBook.Reader := { struct := sr }

structure AddressBook.Builder where
  struct : Capnp.StructBuilder

  deriving BEq

def AddressBook.Builder.fromStruct (sb : Capnp.StructBuilder) : AddressBook.Builder := { struct := sb }


inductive Person.PhoneType where
  | mobile
  | home
  | work
  | unknown (value : UInt16)

  deriving BEq, Repr

def Person.PhoneType.toUInt16 : Person.PhoneType -> UInt16
  | Person.PhoneType.mobile => 0
  | Person.PhoneType.home => 1
  | Person.PhoneType.work => 2
  | Person.PhoneType.unknown v => v

def Person.PhoneType.ofUInt16 : UInt16 -> Person.PhoneType
  | 0 => Person.PhoneType.mobile
  | 1 => Person.PhoneType.home
  | 2 => Person.PhoneType.work
  | v => Person.PhoneType.unknown v

inductive Person.Which where
  | none
  | employment (value : Capnp.Text)
  | unemployed (value : Unit)

instance : BEq Person.Which where
  beq a b :=
    match a, b with
    | Person.Which.none, Person.Which.none => true
    | Person.Which.employment va, Person.Which.employment vb => va == vb
    | Person.Which.unemployed va, Person.Which.unemployed vb => va == vb
    | _, _ => false



mutual
  structure Person where
    id : UInt64
    name : Capnp.Text
    email : Capnp.Text
    phones : Array Person.PhoneNumber
    which : Person.Which


  structure Person.PhoneNumber where
    number : Capnp.Text
    type : Person.PhoneType


  structure AddressBook where
    people : Array Person


end


def Person.Reader.getId (r : Person.Reader) : UInt64 := Capnp.getUInt64 r.struct 0
def Person.Reader.getIdChecked (r : Person.Reader) : Except String (UInt64) := pure (Capnp.getUInt64 r.struct 0)

def Person.Reader.getName (r : Person.Reader) : Capnp.Text := Capnp.readText (Capnp.getPointer r.struct 0)
def Person.Reader.getNameChecked (r : Person.Reader) : Except String (Capnp.Text) := Capnp.readTextChecked (Capnp.getPointer r.struct 0)
def Person.Reader.getNameView (r : Person.Reader) : Capnp.TextView := Capnp.readTextView (Capnp.getPointer r.struct 0)
def Person.Reader.getNameViewChecked (r : Person.Reader) : Except String Capnp.TextView := Capnp.readTextViewChecked (Capnp.getPointer r.struct 0)

def Person.Reader.hasName (r : Person.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 0)


def Person.Reader.getEmail (r : Person.Reader) : Capnp.Text := Capnp.readText (Capnp.getPointer r.struct 1)
def Person.Reader.getEmailChecked (r : Person.Reader) : Except String (Capnp.Text) := Capnp.readTextChecked (Capnp.getPointer r.struct 1)
def Person.Reader.getEmailView (r : Person.Reader) : Capnp.TextView := Capnp.readTextView (Capnp.getPointer r.struct 1)
def Person.Reader.getEmailViewChecked (r : Person.Reader) : Except String Capnp.TextView := Capnp.readTextViewChecked (Capnp.getPointer r.struct 1)

def Person.Reader.hasEmail (r : Person.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 1)


def Person.Reader.getPhones (r : Person.Reader) : Capnp.ListReader Person.PhoneNumber.Reader := Capnp.ListReader.map Person.PhoneNumber.fromStruct (Capnp.readListStructReader (Capnp.getPointer r.struct 2))
def Person.Reader.getPhonesChecked (r : Person.Reader) : Except String (Capnp.ListReader Person.PhoneNumber.Reader) := do
  let r ← Capnp.readListStructCheckedReader (Capnp.getPointer r.struct 2)
  return Capnp.ListReader.map Person.PhoneNumber.fromStruct r
def Person.Reader.hasPhones (r : Person.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 2)


def Person.Reader.getEmployment (r : Person.Reader) : Capnp.Text := Capnp.readText (Capnp.getPointer r.struct 3)
def Person.Reader.getEmploymentChecked (r : Person.Reader) : Except String (Capnp.Text) := Capnp.readTextChecked (Capnp.getPointer r.struct 3)
def Person.Reader.getEmploymentView (r : Person.Reader) : Capnp.TextView := Capnp.readTextView (Capnp.getPointer r.struct 3)
def Person.Reader.getEmploymentViewChecked (r : Person.Reader) : Except String Capnp.TextView := Capnp.readTextViewChecked (Capnp.getPointer r.struct 3)

def Person.Reader.hasEmployment (r : Person.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 3)


def Person.Reader.getUnemployed (_r : Person.Reader) : Unit := ()
def Person.Reader.getUnemployedChecked (_r : Person.Reader) : Except String (Unit) := pure ()

def Person.Reader.which (r : Person.Reader) : Person.Which :=
  let disc := Capnp.getUInt16 r.struct 8
  match disc with
  | 0 => Person.Which.employment (r.getEmployment)
  | 1 => Person.Which.unemployed (r.getUnemployed)
  | _ => Person.Which.none

def Person.Reader.whichChecked (r : Person.Reader) : Except String Person.Which := do
  let disc := Capnp.getUInt16 r.struct 8
  match disc with
  | 0 => do
    let v ← r.getEmploymentChecked
    return Person.Which.employment v
  | 1 => do
    let v ← r.getUnemployedChecked
    return Person.Which.unemployed v
  | _ => return Person.Which.none
def Person.initRoot : Capnp.BuilderM Person.Builder := do
  let p ← Capnp.getRootPointer
  let sb ← Capnp.initStructPointer p 2 4
  return { struct := sb }

def Person.Builder.setId (b : Person.Builder) (v : UInt64) : Capnp.BuilderM Unit := do
  Capnp.setUInt64 b.struct 0 v

def Person.Builder.clearName (b : Person.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 0)

def Person.Builder.setName (b : Person.Builder) (v : Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.writeText (Capnp.getPointerBuilder b.struct 0) v

def Person.Builder.clearEmail (b : Person.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 1)

def Person.Builder.setEmail (b : Person.Builder) (v : Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.writeText (Capnp.getPointerBuilder b.struct 1) v

def Person.Builder.clearPhones (b : Person.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 2)

def Person.Builder.initPhones (b : Person.Builder) (n : Nat) : Capnp.BuilderM (Array Person.PhoneNumber.Builder) := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 2) 1 1 n
  return Array.map Person.PhoneNumber.Builder.fromStruct (Capnp.listStructBuilders lb)
def Person.Builder.setPhonesFromReaders (b : Person.Builder) (v : Array Person.PhoneNumber.Reader) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 2) 1 1 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_0 := 0
  for elem_1 in (v) do
    let sb := builders.getD i_0 emptySb
    Capnp.copyStruct sb elem_1.struct
    i_0 := i_0 + 1

def Person.Builder.clearEmployment (b : Person.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 3)

def Person.Builder.setEmployment (b : Person.Builder) (v : Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.setUInt16 b.struct 8 (UInt16.ofNat 0)
  Capnp.writeText (Capnp.getPointerBuilder b.struct 3) v

def Person.Builder.setUnemployed (b : Person.Builder) : Capnp.BuilderM Unit := do
  Capnp.setUInt16 b.struct 8 (UInt16.ofNat 1)
  pure ()


def Person.PhoneNumber.Reader.getNumber (r : Person.PhoneNumber.Reader) : Capnp.Text := Capnp.readText (Capnp.getPointer r.struct 0)
def Person.PhoneNumber.Reader.getNumberChecked (r : Person.PhoneNumber.Reader) : Except String (Capnp.Text) := Capnp.readTextChecked (Capnp.getPointer r.struct 0)
def Person.PhoneNumber.Reader.getNumberView (r : Person.PhoneNumber.Reader) : Capnp.TextView := Capnp.readTextView (Capnp.getPointer r.struct 0)
def Person.PhoneNumber.Reader.getNumberViewChecked (r : Person.PhoneNumber.Reader) : Except String Capnp.TextView := Capnp.readTextViewChecked (Capnp.getPointer r.struct 0)

def Person.PhoneNumber.Reader.hasNumber (r : Person.PhoneNumber.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 0)


def Person.PhoneNumber.Reader.getType (r : Person.PhoneNumber.Reader) : Person.PhoneType := Person.PhoneType.ofUInt16 (Capnp.getUInt16 r.struct 0)
def Person.PhoneNumber.Reader.getTypeChecked (r : Person.PhoneNumber.Reader) : Except String (Person.PhoneType) := pure (Person.PhoneType.ofUInt16 (Capnp.getUInt16 r.struct 0))
def Person.PhoneNumber.initRoot : Capnp.BuilderM Person.PhoneNumber.Builder := do
  let p ← Capnp.getRootPointer
  let sb ← Capnp.initStructPointer p 1 1
  return { struct := sb }

def Person.PhoneNumber.Builder.clearNumber (b : Person.PhoneNumber.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 0)

def Person.PhoneNumber.Builder.setNumber (b : Person.PhoneNumber.Builder) (v : Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.writeText (Capnp.getPointerBuilder b.struct 0) v

def Person.PhoneNumber.Builder.setType (b : Person.PhoneNumber.Builder) (v : Person.PhoneType) : Capnp.BuilderM Unit := do
  Capnp.setUInt16 b.struct 0 (Person.PhoneType.toUInt16 v)


def AddressBook.Reader.getPeople (r : AddressBook.Reader) : Capnp.ListReader Person.Reader := Capnp.ListReader.map Person.fromStruct (Capnp.readListStructReader (Capnp.getPointer r.struct 0))
def AddressBook.Reader.getPeopleChecked (r : AddressBook.Reader) : Except String (Capnp.ListReader Person.Reader) := do
  let r ← Capnp.readListStructCheckedReader (Capnp.getPointer r.struct 0)
  return Capnp.ListReader.map Person.fromStruct r
def AddressBook.Reader.hasPeople (r : AddressBook.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 0)

def AddressBook.initRoot : Capnp.BuilderM AddressBook.Builder := do
  let p ← Capnp.getRootPointer
  let sb ← Capnp.initStructPointer p 0 1
  return { struct := sb }

def AddressBook.Builder.clearPeople (b : AddressBook.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 0)

def AddressBook.Builder.initPeople (b : AddressBook.Builder) (n : Nat) : Capnp.BuilderM (Array Person.Builder) := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 0) 2 4 n
  return Array.map Person.Builder.fromStruct (Capnp.listStructBuilders lb)
def AddressBook.Builder.setPeopleFromReaders (b : AddressBook.Builder) (v : Array Person.Reader) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 0) 2 4 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_2 := 0
  for elem_3 in (v) do
    let sb := builders.getD i_2 emptySb
    Capnp.copyStruct sb elem_3.struct
    i_2 := i_2 + 1


mutual
  def Person.Builder.setFromValue (b : Person.Builder) (v : Person) : Capnp.BuilderM Unit := do
    b.setId v.id
    b.setName v.name
    b.setEmail v.email
    let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 2) 1 1 (v.phones).size
    let builders := Capnp.listStructBuilders lb
    let emptySb : Capnp.StructBuilder :=
      { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
    let mut i_4 := 0
    for elem_5 in (v.phones) do
      let sb := builders.getD i_4 emptySb
      Person.PhoneNumber.Builder.setFromValue (Person.PhoneNumber.Builder.fromStruct sb) elem_5
      i_4 := i_4 + 1
    match v.which with
    | Person.Which.none => pure ()
    | Person.Which.employment value => do
      b.setEmployment value
    | Person.Which.unemployed value => do
      let _ := value
      b.setUnemployed


  def Person.PhoneNumber.Builder.setFromValue (b : Person.PhoneNumber.Builder) (v : Person.PhoneNumber) : Capnp.BuilderM Unit := do
    b.setNumber v.number
    b.setType v.type


  def AddressBook.Builder.setFromValue (b : AddressBook.Builder) (v : AddressBook) : Capnp.BuilderM Unit := do
    let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 0) 2 4 (v.people).size
    let builders := Capnp.listStructBuilders lb
    let emptySb : Capnp.StructBuilder :=
      { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
    let mut i_6 := 0
    for elem_7 in (v.people) do
      let sb := builders.getD i_6 emptySb
      Person.Builder.setFromValue (Person.Builder.fromStruct sb) elem_7
      i_6 := i_6 + 1


end

def Person.Builder.setPhones (b : Person.Builder) (v : Array Person.PhoneNumber) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 2) 1 1 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_8 := 0
  for elem_9 in (v) do
    let sb := builders.getD i_8 emptySb
    Person.PhoneNumber.Builder.setFromValue (Person.PhoneNumber.Builder.fromStruct sb) elem_9
    i_8 := i_8 + 1


def AddressBook.Builder.setPeople (b : AddressBook.Builder) (v : Array Person) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 0) 2 4 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_10 := 0
  for elem_11 in (v) do
    let sb := builders.getD i_10 emptySb
    Person.Builder.setFromValue (Person.Builder.fromStruct sb) elem_11
    i_10 := i_10 + 1



mutual
  def Person.ofReader (r : Person.Reader) : Person :=
    { id := r.getId
    , name := r.getName
    , email := r.getEmail
    , phones := Capnp.ListReader.toArray (Capnp.ListReader.map (fun x => Person.PhoneNumber.ofReader x) (r.getPhones))
    , which := r.which
    }


  def Person.PhoneNumber.ofReader (r : Person.PhoneNumber.Reader) : Person.PhoneNumber :=
    { number := r.getNumber
    , type := r.getType
    }


  def AddressBook.ofReader (r : AddressBook.Reader) : AddressBook :=
    { people := Capnp.ListReader.toArray (Capnp.ListReader.map (fun x => Person.ofReader x) (r.getPeople))
    }


end

end Capnp.Gen.test.lean4.addressbook
