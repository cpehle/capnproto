-- Generated by capnpc-lean4; DO NOT EDIT.
-- source: test/lean4/fixtures/rpc_echo.capnp

import Capnp.Runtime
import Capnp.Rpc

set_option maxHeartbeats 2000000


namespace Capnp.Gen.test.lean4.fixtures.rpc_echo

abbrev Echo := Capnp.Rpc.Client

namespace Echo

def interfaceId : UInt64 := UInt64.ofNat 17981429201013962691

def fooMethodId : UInt16 := UInt16.ofNat 0
def fooMethod : Capnp.Rpc.Method := { interfaceId := interfaceId, methodId := fooMethodId }
def callFoo (backend : Capnp.Rpc.Backend) (target : Echo) (payload : Capnp.Rpc.Payload := Capnp.emptyRpcEnvelope) : IO Capnp.Rpc.Payload := do
  Capnp.Rpc.call backend target fooMethod payload
def callFooM (target : Echo) (payload : Capnp.Rpc.Payload := Capnp.emptyRpcEnvelope) : Capnp.Rpc.RuntimeM Capnp.Rpc.Payload := do
  Capnp.Rpc.RuntimeM.call target fooMethod payload

def barMethodId : UInt16 := UInt16.ofNat 1
def barMethod : Capnp.Rpc.Method := { interfaceId := interfaceId, methodId := barMethodId }
def callBar (backend : Capnp.Rpc.Backend) (target : Echo) (payload : Capnp.Rpc.Payload := Capnp.emptyRpcEnvelope) : IO Capnp.Rpc.Payload := do
  Capnp.Rpc.call backend target barMethod payload
def callBarM (target : Echo) (payload : Capnp.Rpc.Payload := Capnp.emptyRpcEnvelope) : Capnp.Rpc.RuntimeM Capnp.Rpc.Payload := do
  Capnp.Rpc.RuntimeM.call target barMethod payload

abbrev Handler := Capnp.Rpc.Handler

structure Server where
  foo : Handler
  bar : Handler

def dispatch (server : Server) : Capnp.Rpc.Dispatch := Id.run do
  let mut d := Capnp.Rpc.Dispatch.empty
  d := Capnp.Rpc.Dispatch.register d fooMethod server.foo
  d := Capnp.Rpc.Dispatch.register d barMethod server.bar
  return d

def backend (server : Server)
    (onMissing : Capnp.Rpc.Client -> Capnp.Rpc.Method -> Capnp.Rpc.Payload -> IO Capnp.Rpc.Payload := fun _ _ _ => pure Capnp.emptyRpcEnvelope) : Capnp.Rpc.Backend :=
  (dispatch server).toBackend (onMissing := onMissing)

def registerTarget (runtime : Capnp.Rpc.Runtime) (server : Server)
    (onMissing : Capnp.Rpc.Client -> Capnp.Rpc.Method -> Capnp.Rpc.Payload -> IO Capnp.Rpc.Payload := fun _ _ _ => pure Capnp.emptyRpcEnvelope) : IO Echo := do
  Capnp.Rpc.Runtime.registerDispatchTarget runtime (dispatch server) (onMissing := onMissing)

def registerTargetM (server : Server)
    (onMissing : Capnp.Rpc.Client -> Capnp.Rpc.Method -> Capnp.Rpc.Payload -> IO Capnp.Rpc.Payload := fun _ _ _ => pure Capnp.emptyRpcEnvelope) : Capnp.Rpc.RuntimeM Echo := do
  Capnp.Rpc.RuntimeM.registerDispatchTarget (dispatch server) (onMissing := onMissing)

end Echo
end Capnp.Gen.test.lean4.fixtures.rpc_echo
