-- Generated by capnpc-lean4; DO NOT EDIT.
-- source: test/lean4/fixtures/defaults.capnp

import Capnp.Runtime
import Capnp.Rpc

set_option maxHeartbeats 2000000


namespace Capnp.Gen.test.lean4.fixtures.defaults

structure Nested.Reader where
  struct : Capnp.StructReader

  deriving BEq

def Nested.read (ptr : Capnp.AnyPointer) : Nested.Reader := { struct := Capnp.readStruct ptr }
def Nested.readChecked (ptr : Capnp.AnyPointer) : Except String Nested.Reader := do
  let sr ← Capnp.readStructChecked ptr
  return { struct := sr }
def Nested.fromStruct (sr : Capnp.StructReader) : Nested.Reader := { struct := sr }

structure Nested.Builder where
  struct : Capnp.StructBuilder

  deriving BEq

def Nested.Builder.fromStruct (sb : Capnp.StructBuilder) : Nested.Builder := { struct := sb }


structure Defaults.Reader where
  struct : Capnp.StructReader

  deriving BEq

def Defaults.read (ptr : Capnp.AnyPointer) : Defaults.Reader := { struct := Capnp.readStruct ptr }
def Defaults.readChecked (ptr : Capnp.AnyPointer) : Except String Defaults.Reader := do
  let sr ← Capnp.readStructChecked ptr
  return { struct := sr }
def Defaults.fromStruct (sr : Capnp.StructReader) : Defaults.Reader := { struct := sr }

structure Defaults.Builder where
  struct : Capnp.StructBuilder

  deriving BEq

def Defaults.Builder.fromStruct (sb : Capnp.StructBuilder) : Defaults.Builder := { struct := sb }


inductive Color where
  | red
  | green
  | blue
  | unknown (value : UInt16)

  deriving BEq, Repr

def Color.toUInt16 : Color -> UInt16
  | Color.red => 0
  | Color.green => 1
  | Color.blue => 2
  | Color.unknown v => v

def Color.ofUInt16 : UInt16 -> Color
  | 0 => Color.red
  | 1 => Color.green
  | 2 => Color.blue
  | v => Color.unknown v


mutual
  structure Nested where
    num : UInt32


  structure Defaults where
    boolField : Bool
    int16Field : Int16
    uint32Field : UInt32
    float32Field : Float
    float64Field : Float
    enumField : Color
    textField : Capnp.Text
    dataField : Capnp.Data
    listUInt16 : Array UInt16
    listText : Array Capnp.Text
    listListUInt8 : Array (Array UInt8)
    nested : Nested
    nestedList : Array Nested


end


def Nested.Reader.getNum (r : Nested.Reader) : UInt32 := Capnp.getUInt32 r.struct 0
def Nested.Reader.getNumChecked (r : Nested.Reader) : Except String (UInt32) := pure (Capnp.getUInt32 r.struct 0)
def Nested.initRoot : Capnp.BuilderM Nested.Builder := do
  let p ← Capnp.getRootPointer
  let sb ← Capnp.initStructPointer p 1 0
  return { struct := sb }

def Nested.Builder.setNum (b : Nested.Builder) (v : UInt32) : Capnp.BuilderM Unit := do
  Capnp.setUInt32 b.struct 0 v


def Defaults._default_textField : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 50, 0, 0, 0, 104, 101, 108, 108, 111, 0, 0, 0]))

def Defaults._default_dataField : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 26, 0, 0, 0, 97, 98, 99, 0, 0, 0, 0, 0]))

def Defaults._default_listUInt16 : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 27, 0, 0, 0, 10, 0, 20, 0, 30, 0, 0, 0]))

def Defaults._default_listText : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 5, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 5, 0, 0, 0, 18, 0, 0, 0, 5, 0, 0, 0, 18, 0, 0, 0, 97, 0, 0, 0, 0, 0, 0, 0, 98, 0, 0, 0, 0, 0, 0, 0]))

def Defaults._default_listListUInt8 : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 5, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 5, 0, 0, 0, 18, 0, 0, 0, 5, 0, 0, 0, 10, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0]))

def Defaults._default_nested : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0]))

def Defaults._default_nestedList : Capnp.AnyPointer :=
  Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 4, 0, 0, 0, 1, 0, 0, 0, 23, 0, 0, 0, 8, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0]))

def Defaults.Reader.getBoolField (r : Defaults.Reader) : Bool := Capnp.getBoolMasked r.struct 0 true
def Defaults.Reader.getBoolFieldChecked (r : Defaults.Reader) : Except String (Bool) := pure (Capnp.getBoolMasked r.struct 0 true)

def Defaults.Reader.getInt16Field (r : Defaults.Reader) : Int16 := Capnp.getInt16Masked r.struct 2 (UInt16.ofNat 65413)
def Defaults.Reader.getInt16FieldChecked (r : Defaults.Reader) : Except String (Int16) := pure (Capnp.getInt16Masked r.struct 2 (UInt16.ofNat 65413))

def Defaults.Reader.getUint32Field (r : Defaults.Reader) : UInt32 := Capnp.getUInt32Masked r.struct 4 (UInt32.ofNat 123456)
def Defaults.Reader.getUint32FieldChecked (r : Defaults.Reader) : Except String (UInt32) := pure (Capnp.getUInt32Masked r.struct 4 (UInt32.ofNat 123456))

def Defaults.Reader.getFloat32Field (r : Defaults.Reader) : Float := Capnp.getFloat32Masked r.struct 8 (UInt32.ofNat 1069547520)
def Defaults.Reader.getFloat32FieldChecked (r : Defaults.Reader) : Except String (Float) := pure (Capnp.getFloat32Masked r.struct 8 (UInt32.ofNat 1069547520))

def Defaults.Reader.getFloat64Field (r : Defaults.Reader) : Float := Capnp.getFloat64Masked r.struct 16 (UInt64.ofNat 13835621005235585024)
def Defaults.Reader.getFloat64FieldChecked (r : Defaults.Reader) : Except String (Float) := pure (Capnp.getFloat64Masked r.struct 16 (UInt64.ofNat 13835621005235585024))

def Defaults.Reader.getEnumField (r : Defaults.Reader) : Color := Color.ofUInt16 (Capnp.getUInt16Masked r.struct 12 (UInt16.ofNat 1))
def Defaults.Reader.getEnumFieldChecked (r : Defaults.Reader) : Except String (Color) := pure (Color.ofUInt16 (Capnp.getUInt16Masked r.struct 12 (UInt16.ofNat 1)))

def Defaults.Reader.getTextField (r : Defaults.Reader) : Capnp.Text := Capnp.readText (Capnp.withDefaultPointer (Capnp.getPointer r.struct 0) Defaults._default_textField)
def Defaults.Reader.getTextFieldChecked (r : Defaults.Reader) : Except String (Capnp.Text) := Capnp.readTextChecked (Capnp.withDefaultPointer (Capnp.getPointer r.struct 0) Defaults._default_textField)
def Defaults.Reader.getTextFieldView (r : Defaults.Reader) : Capnp.TextView := Capnp.readTextView (Capnp.withDefaultPointer (Capnp.getPointer r.struct 0) Defaults._default_textField)
def Defaults.Reader.getTextFieldViewChecked (r : Defaults.Reader) : Except String Capnp.TextView := Capnp.readTextViewChecked (Capnp.withDefaultPointer (Capnp.getPointer r.struct 0) Defaults._default_textField)

def Defaults.Reader.hasTextField (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 0)


def Defaults.Reader.getDataField (r : Defaults.Reader) : Capnp.Data := Capnp.readData (Capnp.withDefaultPointer (Capnp.getPointer r.struct 1) Defaults._default_dataField)
def Defaults.Reader.getDataFieldChecked (r : Defaults.Reader) : Except String (Capnp.Data) := Capnp.readDataChecked (Capnp.withDefaultPointer (Capnp.getPointer r.struct 1) Defaults._default_dataField)
def Defaults.Reader.getDataFieldView (r : Defaults.Reader) : Capnp.DataView := Capnp.readDataView (Capnp.withDefaultPointer (Capnp.getPointer r.struct 1) Defaults._default_dataField)
def Defaults.Reader.getDataFieldViewChecked (r : Defaults.Reader) : Except String Capnp.DataView := Capnp.readDataViewChecked (Capnp.withDefaultPointer (Capnp.getPointer r.struct 1) Defaults._default_dataField)

def Defaults.Reader.hasDataField (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 1)


def Defaults.Reader.getListUInt16 (r : Defaults.Reader) : Capnp.ListReader UInt16 := Capnp.readListUInt16Reader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 2) Defaults._default_listUInt16)
def Defaults.Reader.getListUInt16Checked (r : Defaults.Reader) : Except String (Capnp.ListReader UInt16) := Capnp.readListUInt16CheckedReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 2) Defaults._default_listUInt16)
def Defaults.Reader.hasListUInt16 (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 2)


def Defaults.Reader.getListText (r : Defaults.Reader) : Capnp.ListReader Capnp.Text := Capnp.readListTextReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 3) Defaults._default_listText)
def Defaults.Reader.getListTextChecked (r : Defaults.Reader) : Except String (Capnp.ListReader Capnp.Text) := do
  let r ← Capnp.readListPointerCheckedReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 3) Defaults._default_listText)
  return Capnp.ListReader.map Capnp.readText r
def Defaults.Reader.hasListText (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 3)


def Defaults.Reader.getListListUInt8 (r : Defaults.Reader) : Capnp.ListReader (Capnp.ListReader UInt8) := Capnp.ListReader.map (fun p => Capnp.readListUInt8Reader p) (Capnp.readListPointerReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 4) Defaults._default_listListUInt8))
def Defaults.Reader.getListListUInt8Checked (r : Defaults.Reader) : Except String (Capnp.ListReader (Capnp.ListReader UInt8)) := do
  let r ← Capnp.readListPointerCheckedReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 4) Defaults._default_listListUInt8)
  return Capnp.ListReader.map (fun p => Capnp.readListUInt8Reader p) r
def Defaults.Reader.hasListListUInt8 (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 4)


def Defaults.Reader.getNested (r : Defaults.Reader) : Nested.Reader := Nested.read (Capnp.withDefaultPointer (Capnp.getPointer r.struct 5) Defaults._default_nested)
def Defaults.Reader.getNestedChecked (r : Defaults.Reader) : Except String (Nested.Reader) := Nested.readChecked (Capnp.withDefaultPointer (Capnp.getPointer r.struct 5) Defaults._default_nested)
def Defaults.Reader.hasNested (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 5)


def Defaults.Reader.getNestedList (r : Defaults.Reader) : Capnp.ListReader Nested.Reader := Capnp.ListReader.map Nested.fromStruct (Capnp.readListStructReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 6) Defaults._default_nestedList))
def Defaults.Reader.getNestedListChecked (r : Defaults.Reader) : Except String (Capnp.ListReader Nested.Reader) := do
  let r ← Capnp.readListStructCheckedReader (Capnp.withDefaultPointer (Capnp.getPointer r.struct 6) Defaults._default_nestedList)
  return Capnp.ListReader.map Nested.fromStruct r
def Defaults.Reader.hasNestedList (r : Defaults.Reader) : Bool := !Capnp.isNullPointer (Capnp.getPointer r.struct 6)

def Defaults.initRoot : Capnp.BuilderM Defaults.Builder := do
  let p ← Capnp.getRootPointer
  let sb ← Capnp.initStructPointer p 3 7
  return { struct := sb }

def Defaults.Builder.setBoolField (b : Defaults.Builder) (v : Bool) : Capnp.BuilderM Unit := do
  Capnp.setBoolMasked b.struct 0 true v

def Defaults.Builder.setInt16Field (b : Defaults.Builder) (v : Int16) : Capnp.BuilderM Unit := do
  Capnp.setInt16Masked b.struct 2 (UInt16.ofNat 65413) v

def Defaults.Builder.setUint32Field (b : Defaults.Builder) (v : UInt32) : Capnp.BuilderM Unit := do
  Capnp.setUInt32Masked b.struct 4 (UInt32.ofNat 123456) v

def Defaults.Builder.setFloat32Field (b : Defaults.Builder) (v : Float) : Capnp.BuilderM Unit := do
  Capnp.setFloat32Masked b.struct 8 (UInt32.ofNat 1069547520) v

def Defaults.Builder.setFloat64Field (b : Defaults.Builder) (v : Float) : Capnp.BuilderM Unit := do
  Capnp.setFloat64Masked b.struct 16 (UInt64.ofNat 13835621005235585024) v

def Defaults.Builder.setEnumField (b : Defaults.Builder) (v : Color) : Capnp.BuilderM Unit := do
  Capnp.setUInt16Masked b.struct 12 (UInt16.ofNat 1) (Color.toUInt16 v)

def Defaults.Builder.clearTextField (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 0)

def Defaults.Builder.setTextField (b : Defaults.Builder) (v : Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.writeText (Capnp.getPointerBuilder b.struct 0) v

def Defaults.Builder.clearDataField (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 1)

def Defaults.Builder.setDataField (b : Defaults.Builder) (v : Capnp.Data) : Capnp.BuilderM Unit := do
  Capnp.writeData (Capnp.getPointerBuilder b.struct 1) v

def Defaults.Builder.clearListUInt16 (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 2)

def Defaults.Builder.initListUInt16 (b : Defaults.Builder) (n : Nat) : Capnp.BuilderM Capnp.ListBuilder := do
  Capnp.initListPointer (Capnp.getPointerBuilder b.struct 2) Capnp.elemSizeTwoBytes n
def Defaults.Builder.setListUInt16 (b : Defaults.Builder) (v : Array UInt16) : Capnp.BuilderM Unit := do
  Capnp.writeListUInt16 (Capnp.getPointerBuilder b.struct 2) v

def Defaults.Builder.clearListText (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 3)

def Defaults.Builder.initListText (b : Defaults.Builder) (n : Nat) : Capnp.BuilderM (Array Capnp.AnyPointerBuilder) := do
  Capnp.writeListPointer (Capnp.getPointerBuilder b.struct 3) n
def Defaults.Builder.setListText (b : Defaults.Builder) (v : Array Capnp.Text) : Capnp.BuilderM Unit := do
  Capnp.writeListText (Capnp.getPointerBuilder b.struct 3) v

def Defaults.Builder.clearListListUInt8 (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 4)

def Defaults.Builder.initListListUInt8 (b : Defaults.Builder) (n : Nat) : Capnp.BuilderM (Array Capnp.AnyPointerBuilder) := do
  Capnp.writeListPointer (Capnp.getPointerBuilder b.struct 4) n
def Defaults.Builder.setListListUInt8 (b : Defaults.Builder) (v : Array (Array UInt8)) : Capnp.BuilderM Unit := do
  let ptrs ← Capnp.writeListPointer (Capnp.getPointerBuilder b.struct 4) (v).size
  let mut i_12 := 0
  for elem_13 in (v) do
    let p := ptrs.getD i_12 { seg := 0, word := 0 }
    Capnp.writeListUInt8 (p) (elem_13)
    i_12 := i_12 + 1

def Defaults.Builder.clearNested (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 5)

def Defaults.Builder.initNested (b : Defaults.Builder) : Capnp.BuilderM Nested.Builder := do
  let sb ← Capnp.initStructPointer (Capnp.getPointerBuilder b.struct 5) 1 0
  return Nested.Builder.fromStruct sb

def Defaults.Builder.clearNestedList (b : Defaults.Builder) : Capnp.BuilderM Unit := do
  Capnp.clearPointer (Capnp.getPointerBuilder b.struct 6)

def Defaults.Builder.initNestedList (b : Defaults.Builder) (n : Nat) : Capnp.BuilderM (Array Nested.Builder) := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 6) 1 0 n
  return Array.map Nested.Builder.fromStruct (Capnp.listStructBuilders lb)
def Defaults.Builder.setNestedListFromReaders (b : Defaults.Builder) (v : Array Nested.Reader) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 6) 1 0 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_14 := 0
  for elem_15 in (v) do
    let sb := builders.getD i_14 emptySb
    Capnp.copyStruct sb elem_15.struct
    i_14 := i_14 + 1


mutual
  def Nested.Builder.setFromValue (b : Nested.Builder) (v : Nested) : Capnp.BuilderM Unit := do
    b.setNum v.num


  def Defaults.Builder.setFromValue (b : Defaults.Builder) (v : Defaults) : Capnp.BuilderM Unit := do
    b.setBoolField v.boolField
    b.setInt16Field v.int16Field
    b.setUint32Field v.uint32Field
    b.setFloat32Field v.float32Field
    b.setFloat64Field v.float64Field
    b.setEnumField v.enumField
    b.setTextField v.textField
    b.setDataField v.dataField
    Capnp.writeListUInt16 (Capnp.getPointerBuilder b.struct 2) (v.listUInt16)
    Capnp.writeListText (Capnp.getPointerBuilder b.struct 3) (v.listText)
    let ptrs ← Capnp.writeListPointer (Capnp.getPointerBuilder b.struct 4) (v.listListUInt8).size
    let mut i_16 := 0
    for elem_17 in (v.listListUInt8) do
      let p := ptrs.getD i_16 { seg := 0, word := 0 }
      Capnp.writeListUInt8 (p) (elem_17)
      i_16 := i_16 + 1
    let sb ← b.initNested
    Nested.Builder.setFromValue sb v.nested
    let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 6) 1 0 (v.nestedList).size
    let builders := Capnp.listStructBuilders lb
    let emptySb : Capnp.StructBuilder :=
      { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
    let mut i_18 := 0
    for elem_19 in (v.nestedList) do
      let sb := builders.getD i_18 emptySb
      Nested.Builder.setFromValue (Nested.Builder.fromStruct sb) elem_19
      i_18 := i_18 + 1


end

def Defaults.Builder.setNestedList (b : Defaults.Builder) (v : Array Nested) : Capnp.BuilderM Unit := do
  let lb ← Capnp.initStructListPointer (Capnp.getPointerBuilder b.struct 6) 1 0 (v).size
  let builders := Capnp.listStructBuilders lb
  let emptySb : Capnp.StructBuilder :=
    { seg := 0, dataOff := 0, dataWords := 0, ptrOff := 0, ptrCount := 0 }
  let mut i_20 := 0
  for elem_21 in (v) do
    let sb := builders.getD i_20 emptySb
    Nested.Builder.setFromValue (Nested.Builder.fromStruct sb) elem_21
    i_20 := i_20 + 1



mutual
  def Nested.ofReader (r : Nested.Reader) : Nested :=
    { num := r.getNum
    }


  def Defaults.ofReader (r : Defaults.Reader) : Defaults :=
    { boolField := r.getBoolField
    , int16Field := r.getInt16Field
    , uint32Field := r.getUint32Field
    , float32Field := r.getFloat32Field
    , float64Field := r.getFloat64Field
    , enumField := r.getEnumField
    , textField := r.getTextField
    , dataField := r.getDataField
    , listUInt16 := Capnp.ListReader.toArray (r.getListUInt16)
    , listText := Capnp.ListReader.toArray (r.getListText)
    , listListUInt8 := Capnp.ListReader.toArray (Capnp.ListReader.map (fun x => Capnp.ListReader.toArray (x)) (r.getListListUInt8))
    , nested := Nested.ofReader r.getNested
    , nestedList := Capnp.ListReader.toArray (Capnp.ListReader.map (fun x => Nested.ofReader x) (r.getNestedList))
    }


end

def nestedConst : Nested := Nested.ofReader (Nested.read (Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 99, 0, 0, 0, 0, 0, 0, 0]))))
def listConst : Array UInt16 := Capnp.ListReader.toArray (Capnp.readListUInt16Reader (Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 19, 0, 0, 0, 4, 0, 5, 0, 0, 0, 0, 0]))))
def listNestedConst : Array Nested := Capnp.ListReader.toArray (Capnp.ListReader.map (fun x => Nested.ofReader x) (Capnp.ListReader.map Nested.fromStruct (Capnp.readListStructReader (Capnp.getRoot (Capnp.readMessage (ByteArray.mk #[0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 0, 15, 0, 0, 0, 4, 0, 0, 0, 1, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0]))))))
end Capnp.Gen.test.lean4.fixtures.defaults
